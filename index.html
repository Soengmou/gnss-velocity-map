fetch("data/velocity.json")
  .then(res => res.json())
  .then(data => {
    const scale = 5; // 缩放系数，根据需要调节

    data.forEach(point => {
      const vx = point.vx;
      const vy = point.vy;
      const magnitude = Math.sqrt(vx * vx + vy * vy);
      const angle = (Math.atan2(vy, vx) * 180) / Math.PI;

      const length = magnitude * scale;

      const arrowHtml = `
        <div style="
          width: 2px;
          height: ${length}px;
          background: red;
          transform: rotate(${angle}deg);
          transform-origin: bottom center;
          position: relative;
          margin: 0 auto;
        ">
          <div style="
            width: 0; 
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 10px solid red;
            position: absolute;
            bottom: 100%; 
            left: -4px;
          "></div>
        </div>
      `;

      const arrowIcon = L.divIcon({
        className: "",
        html: arrowHtml,
        iconSize: [10, length + 10],  // 宽度，高度要加上箭头尺寸
        iconAnchor: [5, length + 10], // 底部中心点作为锚点
      });

      L.marker([point.lat, point.lon], { icon: arrowIcon }).addTo(map);
    });
  });
